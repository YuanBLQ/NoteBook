# HTTP

传输层我们打交道最多的就是 HTTP 协议，在传输层采用 TCP 协议。因为 TCP 协议属于一种可靠协议，能保证数据无差错、按适当顺序传输到目的地。

## 请求响应过程

已访问 `http://www.example.com/index.html` 为例，当我们在浏览器输入网址回车访问的时候，浏览器内部会进行如下操作：

- 通过 DNS 服务找到 `www.example.com` 所在的 ip 地址，然后 http 客户端在 80 端口发起一个到服务器 `www.example.com` 的 TCP 连接（80 端口是 http 的默认端口）。此时客户端和服务端都会有一个 `套接字(socket)` 与其相连。
- http 客户端通过它的套接字向服务器发送一个 http 请求报文。该报文包含了路径 `index.html` 的资源。
- http 服务器通过它的套接字接收到这个报文，然后对其进行解析，之后把 `index.html` 对象封装到 http 响应报文中，通过套接字发送给客户端。
- http 客户端接收到响应报文后，会发起 TCP 断开操作。http 客户端从响应中解析出报文，处理报文。
- http 客户端把对应响应信息渲染出来给到用户。

上述描述只是一种简单的 `请求-响应` 全过程，真实世界比这个可复杂多了。

## 请求特征

- 支持 C/S 模式
- 简单快速。客户端向服务端请求时，只需传送请求方法和路径。
- 灵活。http允许传输任意类型的数据，传输类型有 `Content-Type` 标记。
- 无连接。这个无连接指的是每次连接只处理一个请求。服务器处理完客户端请求，收到客户端应答后即断开连接。
- 无状态。对于事务处理没有记忆能力。

## 持久链接和非持久链接

每次 TCP 发送完报文之后都会关闭TCP链接，每个 TCP 链接只传输一个请求报文和响应报文。

这种请求响应过程就是一种 `非持久链接`。

由于每次只传输一个请求响应报文，新的传输流程还要重新创建、维护一个新的TCP链接，对于客户端来说压力可能不是很明显，但是对于服务器来说，每个TCP链接都要分配TCP的缓冲区和保持TCP变量，这就给服务器带来严重的负担。

HTTP1.1 可以采用持续连接，服务器在发送完响应之后保持 TCP 连接不关闭，为后续的请求继续报文传输。一段时间后（可配置）如果未使用，HTTP服务器可关闭改连接。

## HTTP报文格式

HTTP 协议主要由三大部分组成：

- 起始行：描述请求或响应的基本信息。
- 头部字段：针对报文的一些详细描述信息。
- 消息正文：实际传输的数据，可以是文本、图片、视频等一切二进制数据。

`起始行` 和 `头部字段` 并成为 `请求头` 或 `响应头`，称之为 `Header`。消息正文也叫实体，称之为 `body`。

HTTP 协议规定，每次发送的报文必须有 Header，但是可以没有 body。Header 和 body 之间必须要有一个空行（CRLF）。

![](https://pages.isyuan.site/tcpip/20210425221553.png)

上面的图如果再加一点点细节，那就是这样的：

![](https://pages.isyuan.site/tcpip/20210425223235.png)

上面这幅图有个小小的注意点，如果使用的是 `GET` 方法，是没有实体体的，使用 `POST` 方法的时候才会有实体体。

HTTP 的响应报文和请求报文类似，如下：

![](https://pages.isyuan.site/tcpip/20210427203757.png)

## cookie & session

HTTP 协议是一种 `无状态协议`，服务端每次接收到客户端的请求时，都是一个全新的请求